#!/usr/bin/env bash
set -e

echo "install joplin-desktop"
wget -O - https://raw.githubusercontent.com/laurent22/joplin/dev/Joplin_install_and_update.sh | bash

echo "install Microsoft Edge (Flatpak)"
if command -v flatpak >/dev/null 2>&1; then
    flatpak install -y flathub com.microsoft.Edge
else
    echo "Flatpak not found. Please install Flatpak to install Microsoft Edge."
fi

echo "recreating fzf shell integration"
echo "eval \"$(fzf --bash)\"" > ~/.fzf_bash_integration

echo "ensure .fzf_bash_integration is sourced in .bashrc"
if ! grep -Fxq "source ~/.fzf_bash_integration" ~/.bashrc; then
    echo "source ~/.fzf_bash_integration" >> ~/.bashrc
    echo "Added 'source ~/.fzf_bash_integration' to ~/.bashrc"
else
    echo "'source ~/.fzf_bash_integration' already present in ~/.bashrc"
fi

echo "install Microsoft Teams PWA in Edge"
echo "To install Teams PWA, launch Edge and visit https://teams.microsoft.com, then install as app from Edge menu."

echo "install VS Code (deb)"
wget -O /tmp/vscode-latest.deb 'https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64'
cd /tmp
sudo apt install -y ./vscode-latest.deb

echo "install Claude Code extension for VS Code"
if command -v code >/dev/null 2>&1; then
    code --install-extension anthropic.claude-code --force
else
    echo "VS Code (code) command not found. Please ensure VS Code is installed and 'code' is in your PATH."
fi

echo "install bracket select extension for VS Code"
if command -v code >/dev/null 2>&1; then
    code --install-extension chunsen.bracket-select --force
else
    echo "VS Code (code) command not found. Please ensure VS Code is installed and 'code' is in your PATH."
fi

echo "Done. Installed snaps and configured KeePassXC interfaces."
